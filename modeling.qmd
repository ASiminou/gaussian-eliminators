---
title: "modeling"
format: html
---

```{r}
library(readr)
library(tidyverse)
library(dplyr)
```

```{r}
acc_games <- read.csv("data/acc_games_cleaned.csv")
acc_teams_stats <- read.csv("data/combined_acc.csv") |>
  mutate(opponent = TeamName)
```

```{r}
acc_games <- acc_games |>
  mutate(Season = season + 1,
         TeamName = team) |>
  select(-season, -team) |>
  filter(Season != 2021) |>
  mutate(
    TeamName = case_when(
      TeamName == "Cal" ~ "California",
      TeamName == "UNC" ~ "North Carolina",
      TeamName == "Florida State" ~ "Florida St.",
      TeamName == "UVA" ~ "Virginia",
      TeamName == "Miami" ~ "Miami FL",
      TeamName == "Pitt" ~ "Pittsburgh",
      TeamName == "NC State" ~ "N.C. State",
      TRUE ~ TeamName
    )
  ) |>
  mutate(
    opponent = case_when(
      opponent == "Cal" ~ "California",
      opponent == "UNC" ~ "North Carolina",
      opponent == "Florida State" ~ "Florida St.",
      opponent == "UVA" ~ "Virginia",
      opponent == "Miami" ~ "Miami FL",
      opponent == "Pitt" ~ "Pittsburgh",
      opponent == "NC State" ~ "N.C. State",
      TRUE ~ opponent)
    )
```

```{r}
merged_data <- left_join(
  acc_games,
  acc_teams_stats,
  by = c("TeamName", "Season")
) |>
  drop_na() |>
  rename("home_eFGPct" = "eFGPct",
         "home_TOPct" = "TOPct",
         "home_ORPct" = "ORPct",
         "home_FTRate" = "FTRate",
         "opponent" = "opponent.x"
         ) |>
  select(-opponent.y)


```

```{r}
merged_all <- left_join(
  merged_data,
  acc_teams_stats,
  by = c("opponent", "Season")
) |>
  rename("away_eFGPct" = "eFGPct",
         "away_TOPct" = "TOPct",
         "away_ORPct" = "ORPct",
         "away_FTRate" = "FTRate",
         "TeamName" = "TeamName.x"
         ) |>
  mutate(
    diff_eFGPct = home_eFGPct - away_eFGPct,
    diff_TOPct = home_TOPct - away_TOPct,
    diff_ORPct = home_ORPct - away_ORPct,
    diff_FTRate = home_FTRate - away_FTRate
  ) |>
  select(
    TeamName, opponent, location, team_score, opp_score, diff, Season, diff_eFGPct, diff_TOPct, diff_ORPct, diff_FTRate
  )|>
  relocate(TeamName, opponent, Season)
```




```{r}
model_1 <- lm(diff ~ diff_eFGPct + diff_TOPct + diff_ORPct + diff_FTRate, data = merged_all)

summary(model_1)$r.squared
```
```{r}

```

